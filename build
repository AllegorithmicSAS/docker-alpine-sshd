#!/bin/bash
set -e
repo="sickp/alpine-sshd"
latest=$(ls -r versions | head -1)
version=${1:-$latest}

docker build -t ${repo}:${version} --pull versions/${version}
echo "=> Built ${repo}:${version}"
if [[ $latest == $version ]]; then
  tags="latest"
  for tag in ${tags}; do
    docker tag -f ${repo}:${version} ${repo}:${tag}
    echo "=> Tagged ${repo}:${tag}"
  done
fi

docker build -t sickp/alpine-sshd:sunshine examples/01_sunshine
docker build -t sickp/alpine-sshd:authkeys examples/02_authorized_keys
docker build -t sickp/alpine-sshd:multiuser examples/03_multiuser
docker build -t sickp/alpine-sshd:hostkeys examples/04_host_keys
